[build]
builder = "NIXPACKS"
# Generate proto files during build (required for gRPC)
# Install system dependencies first, then chromium
buildCommand = "echo 'Build_Force_TS: $(date)' && pip install -r requirements.txt && playwright install-deps chromium && playwright install chromium && chmod +x generate_proto.sh && ./generate_proto.sh"
# Watch paths are evaluated from repository root (new builder ignores this - set in Dashboard)

[deploy]
# Ensure proto files are generated before starting (safety net)
startCommand = "./generate_proto.sh && PYTHONPATH=. python3 main.py"
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[env]
PYTHONUNBUFFERED = "1"
RAILWAY_ENVIRONMENT = "production"
CHIMERA_BRAIN_ADDRESS = "http://chimera-brain.railway.internal:50051"

[environments]
[environments.production]
ENVIRONMENT = "production"
