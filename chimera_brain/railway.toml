[build]
builder = "NIXPACKS"
# Using Nixpacks - Dockerfile removed from git
# Generate proto files during build (required for gRPC)
buildCommand = "pip install -r requirements.txt && chmod +x generate_proto.sh && ./generate_proto.sh"

[deploy]
# Ensure stubs are generated every time before the process starts (safety net)
startCommand = "./generate_proto.sh && PYTHONPATH=. python server.py"
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[env]
PORT = "8080"
CHIMERA_BRAIN_PORT = "50051"
PYTHONUNBUFFERED = "1"

[environments]
[environments.production]
ENVIRONMENT = "production"
